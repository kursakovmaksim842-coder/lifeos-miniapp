<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LifeOS Vision 2026</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #020617;
            --card: rgba(15, 23, 42, 0.6);
            --primary: #3b82f6;
            --lava: #f97316; /* –û—Ä–∞–Ω–∂–µ–≤–∞—è –ª–∞–≤–∞ */
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --text-main: #f8fafc;
            --text-sec: #94a3b8;
        }

        body {
            background: var(--bg); color: var(--text-main);
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0; padding: 0; overflow-x: hidden;
        }

        /* --- iOS 26 TAB BAR --- */
        .tab-bar {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 90%; height: 70px; background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(25px); border-radius: 35px;
            display: flex; justify-content: space-around; align-items: center;
            border: 1px solid var(--border); z-index: 1000;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        .tab-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-sec); font-size: 10px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .tab-item.active { color: var(--primary); transform: translateY(-5px); }
        .tab-item.active .icon-circle { background: var(--primary); color: white; box-shadow: 0 0 15px var(--primary); }
        .icon-circle { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: 0.3s; }

        /* --- LAVA TRACKER --- */
        .lava-container {
            width: 80px; height: 110px; background: #1e293b; border-radius: 15px;
            position: relative; overflow: hidden; border: 2px solid var(--border);
        }
        .lava-wave {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(0deg, #ea580c 0%, #fb923c 100%);
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.5);
        }
        .lava-wave::before {
            content: ""; position: absolute; top: -10px; left: 0; width: 200%; height: 20px;
            background: rgba(251, 146, 60, 0.5); border-radius: 40%;
            animation: wave 3s infinite linear;
        }
        @keyframes wave { from { transform: translateX(0); } to { transform: translateX(-50%); } }

        /* --- LAYOUT --- */
        .container { padding: 25px; padding-bottom: 120px; display: none; }
        .container.active { display: block; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .glass-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 24px; padding: 20px; backdrop-filter: blur(10px); margin-bottom: 20px;
        }

        .header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .title-huge { font-size: 32px; font-weight: 800; letter-spacing: -1px; margin: 0; }

        /* --- FINANCE --- */
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .action-btn {
            height: 56px; border-radius: 18px; border: none; font-weight: 700;
            display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer;
        }
        .btn-plus { background: var(--primary); color: white; }
        .btn-minus { background: #1e293b; color: white; border: 1px solid var(--border); }

        .tx-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px; background: var(--glass); border-radius: 16px; margin-bottom: 8px;
            border: 1px solid transparent; transition: 0.3s;
        }
        .tx-item:active { transform: translateX(20px); border-color: var(--danger); } /* –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–∞–π–ø–∞ */

        /* --- HABITS --- */
        .habit-chip {
            padding: 16px; border-radius: 20px; background: var(--glass);
            border: 1px solid var(--border); margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .habit-chip.done { opacity: 0.5; transform: scale(0.95); background: rgba(59, 130, 246, 0.1); }
        .done-label { color: var(--primary); font-size: 12px; font-weight: 700; margin-bottom: 5px; display: block;}

        .checkbox-ios {
            width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--border);
            display: flex; align-items: center; justify-content: center; transition: 0.3s;
        }
        .habit-chip.done .checkbox-ios { background: var(--primary); border-color: var(--primary); color: white; }

        /* --- INSIGHTS --- */
        .insight-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-value { font-size: 24px; font-weight: 800; color: var(--primary); }
    </style>
</head>
<body>

    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('fin', this)">
            <div class="icon-circle">üèõ</div>
            <span>–§–∏–Ω–∞–Ω—Å—ã</span>
        </div>
        <div class="tab-item" onclick="switchTab('hab', this)">
            <div class="icon-circle">‚ö°</div>
            <span>–ó–∞–¥–∞—á–∏</span>
        </div>
        <div class="tab-item" onclick="switchTab('ins', this)">
            <div class="icon-circle">üìà</div>
            <span>–ò—Ç–æ–≥–∏</span>
        </div>
    </div>

    <div id="tab-fin" class="container active">
        <div class="header-flex">
            <div>
                <div style="color:var(--text-sec); font-size:14px; font-weight:600;">Vision Ledger</div>
                <h1 class="title-huge">–ë–∞–ª–∞–Ω—Å</h1>
            </div>
            <div class="lava-container">
                <div id="lavaWave" class="lava-wave" style="height: 20%;"></div>
                <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-weight:800; font-size:12px; color:white; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
                    <span id="lavaPct">20</span>%
                </div>
            </div>
        </div>

        <div class="glass-card" style="text-align: center; background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.1), transparent);">
            <div style="font-size: 14px; color: var(--text-sec); margin-bottom: 5px;">–î–û–°–¢–£–ü–ù–û –°–ï–ì–û–î–ù–Ø</div>
            <div class="title-huge" id="dailyLimit" style="font-size: 46px; color: var(--primary);">0 ‚ÇΩ</div>
            <div style="font-size: 12px; color: var(--text-sec); margin-top: 15px;" id="monthProgress">–ú–µ—Å—è—Ü: 0 / 0 ‚ÇΩ</div>
        </div>

        <div class="btn-group">
            <button class="action-btn btn-plus" onclick="addMoney()">+ –î–æ—Ö–æ–¥</button>
            <button class="action-btn btn-minus" onclick="addExpense()">- –¢—Ä–∞—Ç–∞</button>
        </div>

        <h3 style="margin-top:30px; font-size:18px;">–ù–µ–¥–∞–≤–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
        <div id="txHistory"></div>
    </div>

    <div id="tab-hab" class="container">
        <div class="header-flex">
            <h1 class="title-huge">–§–æ–∫—É—Å</h1>
            <button onclick="addNewHabit()" style="background:var(--primary); border:none; color:white; padding:8px 16px; border-radius:12px; font-weight:700;">+</button>
        </div>

        <div id="activeHabits">
            </div>

        <div id="completedHabits" style="margin-top: 40px; border-top: 1px solid var(--border); padding-top: 20px;">
            <span class="done-label">–ó–ê–í–ï–†–®–ï–ù–û –°–ï–ì–û–î–ù–Ø</span>
            </div>
    </div>

    <div id="tab-ins" class="container">
        <h1 class="title-huge" style="margin-bottom:25px;">–ò—Ç–æ–≥–∏</h1>
        
        <div class="insight-row">
            <div class="glass-card">
                <div class="stat-value" id="statDays">0</div>
                <div style="font-size:12px; color:var(--text-sec)">–î–Ω–µ–π –≤ –±—é–¥–∂–µ—Ç–µ</div>
            </div>
            <div class="glass-card">
                <div class="stat-value" id="statHabits">0%</div>
                <div style="font-size:12px; color:var(--text-sec)">–£—Å–ø–µ—Ö –ø—Ä–∏–≤—ã—á–µ–∫</div>
            </div>
        </div>

        <div class="glass-card">
            <h3>–†–∞–¥–∞—Ä –î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</h3>
            <canvas id="radarChart"></canvas>
        </div>

        <div class="glass-card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), transparent);">
            <h3 style="margin:0; color:var(--primary);">–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 2026</h3>
            <p id="motivationalText" style="font-size:14px; color:var(--text-sec);">–ü—Ä–∏ —Ç–∞–∫–æ–º —Ç–µ–º–ø–µ —á–µ—Ä–µ–∑ –≥–æ–¥ —Ç—ã –Ω–∞–∫–æ–ø–∏—à—å 450 000 ‚ÇΩ. –≠—Ç–æ —É—Ä–æ–≤–µ–Ω—å 5% –Ω–∞—Å–µ–ª–µ–Ω–∏—è. –ù–µ —Å–±–∞–≤–ª—è–π!</p>
        </div>

        <button onclick="copyDataForBot()" class="action-btn btn-minus" style="width:100%; margin-top:10px;">üìã –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –ë–æ—Ç–æ–º</button>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // --- DATABASE ---
    let core = {
        income: 0,
        balance: 0,
        fixed: 0,
        transactions: [],
        habits: [],
        daysInBudget: 0,
        lastUpdate: null
    };

    const load = () => {
        const d = localStorage.getItem('lifeOS_v5');
        if(d) core = JSON.parse(d);
    };
    const save = () => localStorage.setItem('lifeOS_v5', JSON.stringify(core));

    // --- NAVIGATION ---
    function switchTab(id, el) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        if(id === 'ins') initRadar();
    }

    // --- FINANCE LOGIC ---
    function updateFinUI() {
        const today = new Date().getDate();
        const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
        const daysLeft = daysInMonth - today + 1;
        
        const daily = Math.max(0, Math.floor(core.balance / daysLeft));
        document.getElementById('dailyLimit').innerText = daily.toLocaleString() + ' ‚ÇΩ';
        document.getElementById('monthProgress').innerText = `–ú–µ—Å—è—Ü: ${core.balance.toLocaleString()} / ${core.income.toLocaleString()} ‚ÇΩ`;

        // Lava Update
        const lavaPct = Math.min(100, Math.round((core.daysInBudget / daysInMonth) * 100));
        document.getElementById('lavaWave').style.height = (lavaPct + 10) + '%';
        document.getElementById('lavaPct').innerText = lavaPct;

        renderTx();
    }

    function addMoney() {
        const val = +prompt("–°—É–º–º–∞ –¥–æ—Ö–æ–¥–∞:");
        if(val) {
            core.income += val;
            core.balance += val;
            save(); updateFinUI();
        }
    }

    function addExpense() {
        const val = +prompt("–°—É–º–º–∞ —Ç—Ä–∞—Ç—ã:");
        const cat = prompt("–ù–∞ —á—Ç–æ? (–∫–∞—Ç–µ–≥–æ—Ä–∏—è/–∫–æ–º–º–µ–Ω—Ç):", "–¢—Ä–∞—Ç–∞");
        if(val) {
            core.balance -= val;
            core.transactions.unshift({ id: Date.now(), val, cat, time: new Date().toLocaleTimeString().slice(0,5) });
            save(); updateFinUI();
            tg.HapticFeedback.impactOccurred('medium');
        }
    }

    function renderTx() {
        const list = document.getElementById('txHistory');
        list.innerHTML = core.transactions.slice(0, 5).map(t => `
            <div class="tx-item" onclick="deleteTx(${t.id})">
                <div>
                    <div style="font-weight:700;">${t.cat}</div>
                    <div style="font-size:12px; color:var(--text-sec);">${t.time}</div>
                </div>
                <div style="font-weight:800; color:var(--lava);">-${t.val} ‚ÇΩ</div>
            </div>
        `).join('');
    }

    function deleteTx(id) {
        if(confirm("–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?")) {
            const tx = core.transactions.find(t => t.id === id);
            core.balance += tx.val;
            core.transactions = core.transactions.filter(t => t.id !== id);
            save(); updateFinUI();
        }
    }

    // --- HABITS LOGIC ---
    function renderHabits() {
        const active = document.getElementById('activeHabits');
        const completed = document.getElementById('completedHabits');
        active.innerHTML = '';
        completed.innerHTML = '<span class="done-label">–ó–ê–í–ï–†–®–ï–ù–û –°–ï–ì–û–î–ù–Ø</span>';

        const todayKey = new Date().toDateString();

        core.habits.forEach(h => {
            const isDone = h.doneDate === todayKey;
            const html = `
                <div class="habit-chip ${isDone ? 'done' : ''}" onclick="toggleHabit(${h.id})">
                    <div style="font-weight:700;">${h.name}</div>
                    <div class="checkbox-ios">${isDone ? '‚úî' : ''}</div>
                </div>
            `;
            if(isDone) completed.innerHTML += html;
            else active.innerHTML += html;
        });
    }

    function toggleHabit(id) {
        const h = core.habits.find(x => x.id === id);
        const today = new Date().toDateString();
        if(h.doneDate === today) {
            h.doneDate = null;
        } else {
            h.doneDate = today;
            tg.HapticFeedback.notificationOccurred('success');
        }
        save(); renderHabits();
    }

    function addNewHabit() {
        const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:");
        if(name) {
            core.habits.push({ id: Date.now(), name, doneDate: null });
            save(); renderHabits();
        }
    }

    // --- INSIGHTS ---
    function initRadar() {
        const ctx = document.getElementById('radarChart').getContext('2d');
        if(window.rChart) window.rChart.destroy();

        // –°—á–∏—Ç–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        const financeScore = Math.min(100, (core.balance / (core.income || 1)) * 100);
        const habitScore = (core.habits.filter(h => h.doneDate === new Date().toDateString()).length / (core.habits.length || 1)) * 100;

        window.rChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['–§–∏–Ω–∞–Ω—Å—ã', '–ó–¥–æ—Ä–æ–≤—å–µ', '–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞', '–§–æ–∫—É—Å', '–†–æ—Å—Ç'],
                datasets: [{
                    data: [financeScore, habitScore, 80, 70, 90],
                    backgroundColor: 'rgba(59, 130, 246, 0.2)',
                    borderColor: '#3b82f6',
                    pointBackgroundColor: '#3b82f6'
                }]
            },
            options: {
                scales: { r: { display: false } },
                plugins: { legend: { display: false } }
            }
        });
        
        document.getElementById('statDays').innerText = core.daysInBudget;
        document.getElementById('statHabits').innerText = Math.round(habitScore) + '%';
    }

    function copyDataForBot() {
        const data = `User: ${user?.first_name || 'Incognito'}\nBalance: ${core.balance}\nHabits: ${core.habits.length}`;
        alert("–î–∞–Ω–Ω—ã–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏. –ë–æ—Ç –ø–æ–ª—É—á–∏—Ç –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.");
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å tg.sendData(JSON.stringify(core)) –µ—Å–ª–∏ –±–æ—Ç –æ—Ç–∫—Ä—ã–ª Mini App —á–µ—Ä–µ–∑ KeyboardButton
    }

    // --- STARTUP ---
    load();
    updateFinUI();
    renderHabits();

</script>
</body>
</html>
