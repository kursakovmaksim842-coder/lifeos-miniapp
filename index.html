<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LifeOS</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--bg:#050b16;
--bg2:#0a1424;
--glass:rgba(255,255,255,.06);
--accent:#22c55e;
--accent2:#3b82f6;
--red:#ef4444;
--text:#e5eef7;
--muted:#94a3b8;
--radius:18px;
}

*{font-family:Inter,sans-serif;box-sizing:border-box}
body{
margin:0;padding:16px;color:var(--text);
background:radial-gradient(circle at top, #0a1a30, #050b16);
}

h1{font-size:20px;margin-bottom:12px}
.card{
background:var(--glass);
backdrop-filter:blur(14px);
padding:16px;border-radius:var(--radius);
border:1px solid rgba(255,255,255,.08);
margin-bottom:12px;
}

.flex{display:flex;gap:10px;align-items:center}
.space{display:flex;justify-content:space-between;align-items:center}

button{
padding:10px 16px;border-radius:12px;border:none;
font-weight:600;cursor:pointer
}
.green{background:var(--accent);color:#022c16}
.blue{background:var(--accent2);color:white}
.red{background:var(--red);color:white}
.gray{background:#111827;color:white}

input{
background:#0f172a;border:none;color:white;
padding:10px;border-radius:12px;width:100%
}

.progress{
width:100%;height:10px;background:#0f172a;border-radius:10px;
overflow:hidden
}
.bar{height:100%;background:linear-gradient(90deg,#22c55e,#3b82f6)}

.habit{
display:flex;justify-content:space-between;
padding:8px;border-radius:12px;background:#0f172a;margin-top:6px
}

.big{
font-size:28px;font-weight:700
}
small{color:var(--muted)}
</style>
</head>

<body>

<h1>LifeOS — Your Personal Operating System</h1>

<!-- DASHBOARD -->
<div class="card">
<div class="space">
<div>
<div class="big" id="dailyLimit">— ₽</div>
<small>Сегодняшний безопасный лимит</small>
</div>
<div>
<button class="green" onclick="markGoodDay()">Я в бюджете</button>
<button class="red" onclick="logExpense()">Расход</button>
</div>
</div>
<div class="progress"><div id="dayBar" class="bar"></div></div>
<small>Стрик: <b id="streak">0</b> • Discipline Score: <b id="score">0</b>/100</small>
</div>

<!-- FINANCE SETUP -->
<div class="card">
<h3>Автонастройка бюджета</h3>
<input id="incomeInput" type="number" placeholder="Месячный доход ₽">
<button class="blue" onclick="autoBudget()">AI распределить</button>

<div class="space">
<div>Накопления: <b id="savings">—</b></div>
<div>Обязательные: <b id="mandatory">—</b></div>
<div>Развлечения: <b id="fun">—</b></div>
</div>
</div>

<!-- HABITS -->
<div class="card">
<h3>Привычки (автотрек)</h3>
<div class="flex">
<input id="habitInput" placeholder="Добавить привычку">
<button class="green" onclick="addHabit()">+</button>
</div>
<div id="habitList"></div>
<div class="progress"><div id="habitBar" class="bar"></div></div>
</div>

<!-- ANALYTICS -->
<div class="card">
<h3>Life Analytics</h3>
<canvas id="chart" height="140"></canvas>
</div>

<script>
// ================= STATE =================
let state={
income:0,
savings:0,
mandatory:0,
fun:0,
dailyLimit:0,
spentToday:0,
streak:0,
lastDay:null,
habits:[],
habitLog:{},
history:[]
};

// ================= STORAGE =================
const save=()=>localStorage.setItem("lifeos",JSON.stringify(state));
const load=()=>{const s=localStorage.getItem("lifeos"); if(s) state=JSON.parse(s);};

// ================= AI BUDGET =================
function autoBudget(){
const income=+incomeInput.value;
if(!income) return alert("Введи доход");

state.income=income;

// SMART FINTECH RULES
state.savings=income*0.3;
state.mandatory=income*0.5;
state.fun=income*0.15;
state.dailyLimit=Math.round((income-state.savings-state.mandatory-state.fun)/30);

save(); updateUI();
}

// ================= EXPENSE =================
function logExpense(){
const v=+prompt("Сколько потратил?");
if(!v) return;
state.spentToday+=v;
save(); updateUI();
}

// ================= STREAK =================
function markGoodDay(){
const today=new Date().toDateString();
if(state.lastDay!==today){
state.streak++;
state.lastDay=today;
}
save(); updateUI();
}

// ================= HABITS =================
function addHabit(){
const h=habitInput.value.trim();
if(!h) return;
state.habits.push(h);
habitInput.value="";
save(); renderHabits();
}

function toggleHabit(h){
const d=new Date().toDateString();
if(!state.habitLog[d]) state.habitLog[d]={};
state.habitLog[d][h]=!state.habitLog[d][h];
save(); renderHabits();
}

function renderHabits(){
habitList.innerHTML="";
const d=new Date().toDateString();
let done=0;
state.habits.forEach(h=>{
const c=state.habitLog[d]?.[h];
if(c) done++;
habitList.innerHTML+=`
<div class="habit">
<span>${h}</span>
<input type="checkbox" ${c?"checked":""} onchange="toggleHabit('${h}')">
</div>`;
});
habitBar.style.width=(done/(state.habits.length||1))*100+"%";
}

// ================= UI =================
function updateUI(){
dailyLimit.innerText=state.dailyLimit+" ₽";
savings.innerText=Math.round(state.savings)+" ₽";
mandatory.innerText=Math.round(state.mandatory)+" ₽";
fun.innerText=Math.round(state.fun)+" ₽";
streak.innerText=state.streak;

const left=Math.max(state.dailyLimit-state.spentToday,0);
dayBar.style.width=(left/state.dailyLimit)*100+"%";

const habitScore=(Object.values(state.habitLog[new Date().toDateString()]||{}).filter(Boolean).length/(state.habits.length||1))*50;
const budgetScore=state.spentToday<=state.dailyLimit?50:0;
score.innerText=Math.round(habitScore+budgetScore);

state.history.push({t:Date.now(),left});
if(state.history.length>30) state.history.shift();
drawChart();
}

// ================= CHART =================
let chart;
function drawChart(){
const ctx=document.getElementById("chart");
const labels=state.history.map(h=>new Date(h.t).toLocaleDateString());
const data=state.history.map(h=>h.left);

if(chart) chart.destroy();
chart=new Chart(ctx,{
type:"line",
data:{labels,datasets:[{data,borderColor:"#22c55e",fill:false}]},
options:{plugins:{legend:{display:false}},scales:{x:{display:false}}}
});
}

// ================= INIT =================
load();
renderHabits();
updateUI();
</script>

</body>
</html>
